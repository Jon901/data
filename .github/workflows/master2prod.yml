name: master2prod

on:
  push:
    branches: 
      - master

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      name: git pull
      with:
        directory: src/github.com/raid-codex/data
    - uses: actions/setup-go@v1
      name: "setup go"
      with:
        go-version: '1.13.4'
    - name: "install raid-codex-cli"
      run: |
        go get github.com/raid-codex/tools/cmd/raid-codex-cli
        go install github.com/raid-codex/tools/cmd/raid-codex-cli
    - name: "all"
      run: |
        export PATH="/home/runner/go/bin:$PATH"
        export GOPATH=`pwd`
        cd src/github.com/raid-codex/data
        make all
    - name: "commit changes"
      run: |
        cd src/github.com/raid-codex/data
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add . --all
        git commit -m "build(prod): generated by Github actions"
    - name: "push changes"
      uses: ad-m/github-push-action@master
      with:
        directory: src/github.com/raid-codex/data
        repository: raid-codex/data
        branch: prod
        
